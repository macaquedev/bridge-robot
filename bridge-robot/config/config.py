from pathlib import Path 
import shapely


MAINCAM_INDEX = 1
MAINCAM_WIDTH = 3840
MAINCAM_HEIGHT = 2160
DETECT_FRAME_SIZE = 1080
DETECT_CARD_WIDTH = DETECT_FRAME_SIZE // 6
DETECT_CARD_HEIGHT = DETECT_FRAME_SIZE // 4
BLUR_COEFFICIENT = 15
ARMCAM_INDEX = 2
ARMCAM_WIDTH = 640
ARMCAM_HEIGHT = 480
ARMCAM_OFFSET = 265
ARMCAM_MISDETECTION_THRESHOLD = 7
CARDNET_PATH = Path(__file__).parent.parent / "model" / "smallcardnet-40ep.pt"
CARDNET_CONFIDENCE = 0.35
BIDDING_BOX_NET_PATH = Path(__file__).parent.parent / "model" / "bidding-box-net-50ep.pt"
BIDDING_BOX_NET_CONFIDENCE = 0.28
ARDUINO_BAUDRATE = 115200

CARD_AREA = 2000
BKG_THRESH = 100
COALESCE_DISTANCE_SQUARED = 400
UPSIDE_DOWN_THRESH = 210

MAD_THRESHOLD = 2
AUCTION_ADD_THRESHOLD = 2
AUCTION_REMOVE_THRESHOLD = 3
CARDPLAY_ADD_THRESHOLD = 3
CARDPLAY_REMOVE_THRESHOLD = 1
MIN_BID_AREA = 2300

AUCTION_TOP_POLYGON = shapely.geometry.Polygon([(300, 0), (1080, 0), (1080, 200), (300, 200)])
AUCTION_LEFT_POLYGON = shapely.geometry.Polygon([(0, 0), (299, 0), (299, 400), (0, 400)])
AUCTION_RIGHT_POLYGON = shapely.geometry.Polygon([(1080, 607), (1080, 200), (780, 200), (780, 607)])
AUCTION_BOTTOM_POLYGON = shapely.geometry.Polygon([(0, 400), (780, 400), (780, 607), (0, 607)])


TOP_POLYGON = shapely.geometry.Polygon([(300, 0), (1080, 0), (1080, 200), (300, 200)])
LEFT_POLYGON = shapely.geometry.Polygon([(0, 0), (299, 0), (299, 400), (0, 400)])
RIGHT_POLYGON = shapely.geometry.Polygon([(1080, 607), (1080, 200), (780, 200), (780, 607)])
BOTTOM_POLYGON = shapely.geometry.Polygon([(0, 400), (780, 400), (780, 607), (0, 607)])

CARDPLAY_TOP_POLYGON = shapely.geometry.Polygon([(711.11111111, 0), (2560, 0), (2560, 474.07407407), (711.11111111, 474.07407407)])
CARDPLAY_LEFT_POLYGON = shapely.geometry.Polygon([(0, 0), (710.37037037, 0), (710.37037037, 948.14814815), (0, 948.14814815)])
CARDPLAY_RIGHT_POLYGON = shapely.geometry.Polygon([(2560, 1437.03703704), (2560, 474.07407407), (1851.85185185, 474.07407407), (1851.85185185, 1437.03703704)])
CARDPLAY_BOTTOM_POLYGON = shapely.geometry.Polygon([(0, 948.14814815), (1851.85185185, 948.14814815), (1851.85185185, 1437.03703704), (0, 1437.03703704)])

SORTFUNCS = [
    lambda x: -x[1][0],
    lambda x: -x[1][1],
    lambda x: x[1][0],
    lambda x: x[1][1]
]